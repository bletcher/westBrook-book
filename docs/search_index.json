[["index.html", "The West Brook Story Chapter 1 Introduction", " The West Brook Story Ben Letcher 2022-03-16 Chapter 1 Introduction This book describes accessing, cleaning, and analyzing data from the West Brook Study in Whateley MA, USA. Use bookdown::render_book() to render the book (not showing up in the Build tab like the bookdown book (https://bookdown.org/yihui/bookdown/usage.html) says it should. Use bookdown::render_book(\"index.Rmd\", \"bookdown::gitbook\") to force html book. Use clean_book() to clean up temporary files. "],["wrangle.html", "Chapter 2 Wrangle the data", " Chapter 2 Wrangle the data This section takes cdWB_electro0 and cleans it to create cdWB. Will add additional cleaning steps for cdWB_electro0 and for the other data frames. library(tidyverse) # devtools::install_github(&#39;bletcher/getPrepareWBData&#39;) library(getPrepareWBData) # this has functions for preparing West Brook data reclean_cdWB_electro &lt;- FALSE if(reclean_cdWB_electro){ drainage &lt;- &#39;west&#39; # functions in getPrepareWBData library cdWB_electro &lt;- cdWB_electro0 %&gt;% cleanData(drainage) %&gt;% mergeSites(drainage) %&gt;% addNPasses(drainage) %&gt;% mutate(drainage = drainage) save(cdWB_electro, file = &#39;./data/cdWB_electro.RData&#39;) } else { load(file = &#39;./data/cdWB_electro.RData&#39;) } "],["getData.html", "Chapter 3 Get fish data from the server", " Chapter 3 Get fish data from the server The server hosting the data is named osensei and is at UMass (osensei.cns.umass.edu). It can be accessed using functions in the getWBData package. Use devtools::install_github('Conte-Ecology/westBrookData/getWBData') to install. Most of the functions will run reconnect() to connect to the server with your username and password. Run reconnect() from the console to connect if necessary. Use conDplyr to see the list of available tables on the server. Details about the getWBData package are here. There are four main databases we want to create: 1. cdWB_electro0 West Brook electrofishing data, 3 species (brook trout, brown trout and Atlantic salmon), tagged and untagged fish 2. cdWB_CMR0 West Brook electrofishing data formatted for Capture-Mark-Recapture analysis for tagged individuals 3. cdWB_wanding0 West Brook wanding (portable antenna) data, all tagged salmonids 4. cdWB_antenna0 West Brook stationary antenna data, all tagged salmonids The 0 at the end of these file names indicates that they are the initial files that will be wrangled in the next step (next chapter). cd stands for core data. getNew_cdWB_electro0 &lt;- FALSE getNew_cdWB_CMR0 &lt;- FALSE getNew_cdWB_wanding0 &lt;- FALSE getNew_cdWB_antenna0 &lt;- FALSE West Brook electrofishing data, all salmonids (tagged and untagged) # default values for createCoreData() # function (sampleType = &quot;electrofishing&quot;, baseColumns = T, # columnsToAdd = NULL, includeUntagged = F, whichDrainage = &quot;west&quot;) if(getNew_cdWB_electro0) { cdWB_electro0 &lt;- createCoreData( sampleType = &quot;electrofishing&quot;, #&quot;stationaryAntenna&quot;,&quot;portableAntenna&quot; columnsToAdd = c(&quot;sampleNumber&quot;, &quot;river&quot;, &quot;survey&quot;, &quot;pass&quot;, &quot;observedLength&quot;, &quot;observedWeight&quot;, &quot;comments&quot;), includeUntagged = TRUE, whichDrainage = &quot;west&quot; ) %&gt;% addTagProperties( columnsToAdd = c(&quot;cohort&quot;, &quot;species&quot;, &quot;dateEmigrated&quot;, &quot;sex&quot;, &quot;species&quot; ) ) %&gt;% dplyr::filter(species %in% c( &quot;bkt&quot;,&quot;bnt&quot;,&quot;ats&quot;), area %in% c(&quot;trib&quot;,&quot;inside&quot;,&quot;below&quot;,&quot;above&quot;), !is.na(sampleNumber)) %&gt;% addSampleProperties() %&gt;% addEnvironmental() save(cdWB_electro0, file = &#39;./data/cdWB_electro0.RData&#39;) } else { load(file = &#39;./data/cdWB_electro0.RData&#39;) } str(cdWB_electro0) ## tibble [91,103 x 22] (S3: tbl_df/tbl/data.frame) ## $ tag : chr [1:91103] &quot;00088cbed0&quot; &quot;00088cbed3&quot; &quot;00088cbed4&quot; &quot;00088cbed4&quot; ... ## $ detectionDate : POSIXct[1:91103], format: &quot;2013-03-25 00:00:00&quot; &quot;2012-06-07 09:03:00&quot; &quot;2013-03-29 10:08:00&quot; &quot;2013-06-25 14:51:00&quot; ... ## $ sampleName : chr [1:91103] &quot;84&quot; &quot;81&quot; &quot;84&quot; &quot;85&quot; ... ## $ sampleNumber : num [1:91103] 73 70 73 74 70 71 73 79 80 71 ... ## $ river : chr [1:91103] &quot;wb obear&quot; &quot;west brook&quot; &quot;west brook&quot; &quot;west brook&quot; ... ## $ section : chr [1:91103] &quot;7&quot; &quot;1&quot; &quot;40&quot; &quot;44&quot; ... ## $ area : chr [1:91103] &quot;trib&quot; &quot;inside&quot; &quot;inside&quot; &quot;inside&quot; ... ## $ observedLength : num [1:91103] 62 62 109 154 113 120 147 70 74 86 ... ## $ survey : chr [1:91103] &quot;shock&quot; &quot;shock&quot; &quot;shock&quot; &quot;shock&quot; ... ## $ pass : num [1:91103] 1 1 1 1 1 1 1 1 1 1 ... ## $ observedWeight : num [1:91103] 1.9 2.7 12.6 41.3 15.5 18.3 30.4 3.5 4.8 6.7 ... ## $ comments : chr [1:91103] &quot;additional genetic sample&quot; NA NA NA ... ## $ cohort : num [1:91103] 2012 2012 2012 2012 2011 ... ## $ species : chr [1:91103] &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; ... ## $ dateEmigrated : Date[1:91103], format: NA NA NA NA ... ## $ sex : chr [1:91103] NA NA NA NA ... ## $ year : num [1:91103] 2013 2012 2013 2013 2012 ... ## $ season : num [1:91103] 1 2 1 2 2 3 1 3 4 3 ... ## $ proportionSampled: num [1:91103] 1 1 1 1 1 1 1 1 1 1 ... ## $ lagDetectionDate : POSIXct[1:91103], format: NA NA &quot;2013-06-25 14:51:00&quot; NA ... ## $ meanTemperature : num [1:91103] NaN NaN 10.7 NaN 16.5 ... ## $ meanFlow : num [1:91103] NaN NaN 0.5247 NaN 0.0338 ... West Brook electrofishing data formatted for Capture-Mark-Recapture analysis for tagged individuals if(getNew_cdWB_CMR0) { cdWB_CMR0 &lt;- createCoreData( sampleType = &quot;electrofishing&quot;, #&quot;stationaryAntenna&quot;,&quot;portableAntenna&quot;), whichDrainage = &quot;west&quot;, columnsToAdd = c(&quot;sampleNumber&quot;, &quot;river&quot;, &quot;riverMeter&quot;, &quot;survey&quot;, &quot;pass&quot;, &#39;observedLength&#39;, &#39;observedWeight&#39;) ) %&gt;% addTagProperties( columnsToAdd = c(&quot;cohort&quot;, &quot;species&quot;, &quot;dateEmigrated&quot;, &quot;sex&quot;, &quot;species&quot;) ) %&gt;% dplyr::filter(!is.na(tag), area %in% c(&quot;trib&quot;,&quot;inside&quot;,&quot;below&quot;,&quot;above&quot;), !is.na(sampleNumber) ) %&gt;% createCmrData(maxAgeInSamples = 20, inside = F, censorDead = F, censorEmigrated = T) %&gt;% addSampleProperties() %&gt;% addEnvironmental() %&gt;% addKnownZ() %&gt;% fillSizeLocation(size = F) #assumes fish stay in same location until observed elsewhere save(cdWB_CMR0, file = &#39;./data/cdWB_CMR0.RData&#39;) } else { load(file = &#39;./data/cdWB_CMR0.RData&#39;) } str(cdWB_CMR0) ## tibble [483,605 x 26] (S3: tbl_df/tbl/data.frame) ## $ tag : chr [1:483605] &quot;00088cc21e&quot; &quot;00088cc21e&quot; &quot;00088cc21e&quot; &quot;00088cc21e&quot; ... ## $ cohort : num [1:483605] 2012 2012 2012 2012 2012 ... ## $ detectionDate : POSIXct[1:483605], format: &quot;2012-06-05 00:00:00&quot; &quot;2012-09-17 00:00:00&quot; &quot;2012-12-12 00:00:00&quot; &quot;2013-03-25 00:00:00&quot; ... ## $ sampleName : chr [1:483605] &quot;81&quot; &quot;82&quot; &quot;83&quot; &quot;84&quot; ... ## $ sampleNumber : num [1:483605] 70 71 72 73 74 75 76 77 78 79 ... ## $ river : chr [1:483605] &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; ... ## $ section : chr [1:483605] &quot;13&quot; &quot;14&quot; &quot;14&quot; &quot;14&quot; ... ## $ area : chr [1:483605] &quot;trib&quot; &quot;trib&quot; &quot;trib&quot; &quot;trib&quot; ... ## $ observedLength : num [1:483605] 61 67 NA NA NA NA NA NA NA NA ... ## $ survey : chr [1:483605] &quot;shock&quot; &quot;shock&quot; NA NA ... ## $ pass : num [1:483605] 1 1 NA NA NA NA NA NA NA NA ... ## $ observedWeight : num [1:483605] 2.7 3.1 NA NA NA NA NA NA NA NA ... ## $ species : chr [1:483605] &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; ... ## $ dateEmigrated : Date[1:483605], format: NA NA NA NA ... ## $ sex : chr [1:483605] NA NA NA NA ... ## $ enc : num [1:483605] 1 1 0 0 0 0 0 0 0 0 ... ## $ ageInSamples : num [1:483605] 0 1 2 3 4 5 6 7 8 9 ... ## $ sampleIndex : num [1:483605] 60 61 62 63 64 65 66 67 68 69 ... ## $ tagIndex : num [1:483605] 385 385 385 385 385 385 385 385 385 385 ... ## $ year : num [1:483605] 2012 2012 2012 2013 2013 ... ## $ season : num [1:483605] 2 3 4 1 2 3 4 1 2 3 ... ## $ proportionSampled: num [1:483605] 1 1 NA NA NA NA NA NA NA NA ... ## $ lagDetectionDate : POSIXct[1:483605], format: &quot;2012-09-17 00:00:00&quot; &quot;2012-12-12 00:00:00&quot; &quot;2013-03-25 00:00:00&quot; &quot;2013-06-05 00:00:00&quot; ... ## $ meanTemperature : num [1:483605] 16.48 7.98 1.25 9.13 16.51 ... ## $ meanFlow : num [1:483605] 0.0315 0.135 0.3647 0.3887 0.3033 ... ## $ knownZ : num [1:483605] 1 1 2 2 2 2 2 2 2 2 ... West Brook wanding data, all salmonids (tagged) if(getNew_cdWB_wanding0) { # from wandingDataWB project in d:/ben/github/wandingData/ cdWB_wanding0 &lt;- createCoreData( sampleType = &quot;portableAntenna&quot;, columnsToAdd = c(&quot;tag&quot;, &quot;detectionDate&quot;, &quot;river&quot;, &quot;area&quot;, &quot;section&quot;, &quot;survey&quot;, &quot;sampleName&quot;, &quot;readerId&quot;, &quot;aliveOrDead&quot;, &quot;instance&quot;, &quot;pass&quot;, &quot;quarter&quot;, &quot;leftOrRight&quot;, &quot;habitat&quot;, &quot;cover&quot;, &quot;justification&quot;, &quot;comment&quot;) ) %&gt;% addTagProperties() %&gt;% dplyr::filter( species %in% c( &quot;bkt&quot;,&quot;bnt&quot;,&quot;ats&quot; ) ) save(cdWB_wanding0, file = &#39;./data/cdWB_wanding0.RData&#39;) } else { load(file = &#39;./data/cdWB_wanding0.RData&#39;) } str(cdWB_wanding0) ## tibble [14,880 x 19] (S3: tbl_df/tbl/data.frame) ## $ tag : chr [1:14880] &quot;00088cf41b&quot; &quot;00088cf41b&quot; &quot;00088cf41b&quot; &quot;00088cf435&quot; ... ## $ detectionDate: POSIXct[1:14880], format: &quot;2010-09-27 11:08:45&quot; &quot;2010-10-18 14:16:22&quot; &quot;2010-10-25 11:40:24&quot; &quot;2010-12-06 13:32:15&quot; ... ## $ sampleName : chr [1:14880] &quot;92710.00&quot; &quot;101810.00&quot; &quot;102510.00&quot; &quot;12610.00&quot; ... ## $ river : chr [1:14880] &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; ... ## $ section : chr [1:14880] &quot;13&quot; &quot;14&quot; &quot;14&quot; &quot;2&quot; ... ## $ area : chr [1:14880] &quot;trib&quot; &quot;trib&quot; &quot;trib&quot; &quot;trib&quot; ... ## $ survey : chr [1:14880] &quot;portableAntenna&quot; &quot;portableAntenna&quot; &quot;portableAntenna&quot; &quot;portableAntenna&quot; ... ## $ readerId : chr [1:14880] &quot;iso&quot; &quot;iso&quot; &quot;iso&quot; &quot;iso&quot; ... ## $ aliveOrDead : chr [1:14880] &quot;alive&quot; &quot;alive&quot; NA &quot;alive&quot; ... ## $ instance : num [1:14880] 1 2 3 1 1 1 2 1 1 1 ... ## $ pass : num [1:14880] NA NA NA NA NA NA NA NA NA NA ... ## $ quarter : num [1:14880] 2 1 NA 4 2 4 4 3 4 2 ... ## $ leftOrRight : chr [1:14880] &quot;l&quot; &quot;m&quot; NA &quot;r&quot; ... ## $ habitat : chr [1:14880] &quot;pool&quot; &quot;run&quot; NA &quot;pool&quot; ... ## $ cover : chr [1:14880] NA NA NA NA ... ## $ justification: chr [1:14880] NA NA NA NA ... ## $ comment : chr [1:14880] NA NA NA NA ... ## $ species : chr [1:14880] &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; ... ## $ cohort : num [1:14880] 2010 2010 2010 2010 2009 ... West Brook antenna data, all tagged salmonids Note: some pitAntenna code at https://github.com/bletcher/pitAntenna/blob/master/WB/getAndPrepareDataWB.R if(getNew_cdWB_antenna0) { cdWB_antenna0 &lt;- createCoreData( sampleType=c(&quot;stationaryAntenna&quot;), whichDrainage = &quot;west&quot;, columnsToAdd=c( &quot;river&quot;, &quot;riverMeter&quot;, &quot;survey&quot;, &quot;readerID&quot;, &quot;comment&quot; ) ) %&gt;% filter(!is.na(tag)) %&gt;% # for now addTagProperties(columnsToAdd = c( &quot;cohort&quot;, &quot;species&quot;, &quot;dateEmigrated&quot;, &quot;sex&quot;, &quot;species&quot;) ) save(cdWB_antenna0, file = &#39;./data/cdWB_antenna0.RData&#39;) } else { load(file = &#39;./data/cdWB_antenna0.RData&#39;) } str(cdWB_antenna0) ## tibble [410,915 x 10] (S3: tbl_df/tbl/data.frame) ## $ tag : chr [1:410915] &quot;00088cbed9&quot; &quot;00088cbed9&quot; &quot;00088cbed9&quot; &quot;00088cbed9&quot; ... ## $ detectionDate: POSIXct[1:410915], format: &quot;2014-10-17 20:22:33&quot; &quot;2014-10-24 15:34:31&quot; &quot;2014-10-24 16:03:51&quot; &quot;2014-10-24 17:29:37&quot; ... ## $ river : chr [1:410915] &quot;wb mitchell&quot; &quot;wb mitchell&quot; &quot;wb mitchell&quot; &quot;wb mitchell&quot; ... ## $ riverMeter : num [1:410915] 4797 4797 4830 4830 5524 ... ## $ survey : chr [1:410915] &quot;stationaryAntenna&quot; &quot;stationaryAntenna&quot; &quot;stationaryAntenna&quot; &quot;stationaryAntenna&quot; ... ## $ comment : chr [1:410915] NA NA NA NA ... ## $ cohort : num [1:410915] 2013 2013 2013 2013 2013 ... ## $ species : chr [1:410915] &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; &quot;bkt&quot; ... ## $ dateEmigrated: Date[1:410915], format: &quot;2014-10-25&quot; &quot;2014-10-25&quot; &quot;2014-10-25&quot; &quot;2014-10-25&quot; ... ## $ sex : chr [1:410915] NA NA NA NA ... "],["yoyGrowthModel.html", "Chapter 4 Young-of-year Growth Model 4.1 Raw data 4.2 Raw data plots 4.3 Yearly means", " Chapter 4 Young-of-year Growth Model The question here is what is driving body size variation across years in brook trout and brown trout in the WB? We focus on ageInSamples == 1 (age-0 fish in the fall sample) fish for growth model. This is the first sampling occasion that most fish are big enough to tag. Not all fish are big enough, however, and there is a number of untagged fish each year. We need to include both tagged and untagged fish in our age-0 size model. Factors to include in the model are 1. Sample date 2. Cumulative temperature prior to sampling 3. Cumulative flow prior to sampling 4. Extreme flow events?? 5. Fish density, maybe total and age-0 across all three salmonids?? 4.1 Raw data Environmental data (flow, temperature) are from assumed spawning dates, assumed emergence dates and actual observation (sample) dates. All fish data are from age-0 in autumn. Abundance data? 4.1.1 Get environmental data getNew_envDataWB &lt;- FALSE West Brook environmental data (flow and temperature) if(getNew_envDataWB) { reconnect() envDataWB &lt;- tbl(conDplyr, &quot;data_daily_temperature&quot;) %&gt;% collect(n = Inf) %&gt;% full_join(tbl(conDplyr, &quot;data_flow_extension&quot;) %&gt;% collect(n = Inf), by = c(&quot;river&quot;, &quot;date&quot;)) %&gt;% select(-source) %&gt;% rename(temperature = daily_mean_temp, flow = qPredicted) %&gt;% mutate(dateDate = as_date(date)) save(envDataWB, file = &#39;./data/envDataWB.RData&#39;) } else { load(file = &#39;./data/envDataWB.RData&#39;) } str(envDataWB) ## tibble [32,189 x 7] (S3: tbl_df/tbl/data.frame) ## $ river : chr [1:32189] &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; &quot;wb jimmy&quot; ... ## $ date : POSIXct[1:32189], format: &quot;1997-05-14&quot; &quot;1997-05-15&quot; &quot;1997-05-16&quot; &quot;1997-05-17&quot; ... ## $ temperature : num [1:32189] 11.57 10.4 10.55 8.84 9.09 ... ## $ daily_max_temp: num [1:32189] 11.6 12.3 11.9 10.2 11.6 ... ## $ daily_min_temp: num [1:32189] 11.57 8.96 9.73 7.74 7.45 ... ## $ flow : num [1:32189] NA NA NA NA NA NA NA NA NA NA ... ## $ dateDate : Date[1:32189], format: &quot;1997-05-14&quot; &quot;1997-05-15&quot; &quot;1997-05-16&quot; &quot;1997-05-17&quot; ... 4.1.2 Get first observations Filter cdWB_electro for first observations in the autumn for age-0 fish (ageInsamples == 0). Including both tagged and untagged fish. selectedVariables &lt;- c(&quot;tag&quot;, &quot;species&quot;, &quot;river&quot;, &quot;detectionDate&quot;, &quot;sampleNumber&quot;, &quot;n&quot;, &quot;proportionSampled&quot;, &quot;observedLength&quot;, &quot;observedWeight&quot;, &quot;area&quot;) firstObs_noTag &lt;- cdWB_electro %&gt;% filter(is.na(tag), ageInSamples == 1) %&gt;% mutate(n = 1) %&gt;% select(all_of(selectedVariables)) firstObs_tag &lt;- cdWB_electro %&gt;% group_by(tag) %&gt;% mutate(isFirstObs = detectionDate == min(detectionDate), n = n()) %&gt;% filter(isFirstObs, ageInSamples == 1) %&gt;% select(all_of(selectedVariables)) %&gt;% ungroup() firstObs0 &lt;- add_row(firstObs_tag, firstObs_noTag) %&gt;% mutate(date = as_date(detectionDate), yday = yday(date)) 4.1.3 Get environmental data (flow, temp) from the server. For each captured fish in firstObs0, calculate summary stats for flow and temperature for different time periods: 1. Assumed spawning to capture 2. Assumed spawning to assumed emergence 3. Assumed emergence to capture Then merge results with firstObs0 to create firstObs. spawn_month &lt;- &quot;11&quot; # spawning spawn_day &lt;- &quot;15&quot; emerge_month &lt;- &quot;03&quot; # emergence emerge_day &lt;- &quot;01&quot; firstObsDates &lt;- firstObs %&gt;% distinct(date = date(detectionDate), river) # move to getPrepareWBData getEnvMeans &lt;- function(riverIn, start, end) { out &lt;- envData %&gt;% filter(river == riverIn, dateDate &gt;= start, dateDate &lt;= end) %&gt;% summarize( sumT = sum(temperature, na.rm = TRUE), meanT = mean(temperature, na.rm = TRUE), sdT = sd(temperature, na.rm = TRUE), cvT = sdT/meanT, sumF = sum(flow, na.rm = TRUE), meanF = mean(flow, na.rm = TRUE), sdF = sd(flow, na.rm = TRUE), cvF = sdF/meanF, n = n() ) #message(paste(river, start, end,tag)) return(out) } firstObs_Env &lt;- firstObsDates %&gt;% rowwise() %&gt;% mutate( year = year(date), spawnDate = ymd(paste0(year,spawn_month,spawn_day)) - years(1), emergeDate = ymd(paste0(year,emerge_month,emerge_day)), spawn_emerge = list(getEnvMeans(river, spawnDate, emergeDate)), emerge_detect = list(getEnvMeans(river, emergeDate, date)), spawn_detect = list(getEnvMeans(river, spawnDate, date)) ) # merge env data into firstObs0 firstObs &lt;- firstObs0 %&gt;% left_join(firstObs_Env) #str(firstObs) Unnest firstObs so environmental summary stats are available as data frame with the name of the time interval as the prefix to the statisticVariable name firstObsUnnested &lt;- firstObs %&gt;% unnest(cols = c(spawn_emerge, emerge_detect, spawn_detect), names_sep = &quot;_&quot;) str(firstObsUnnested) ## tibble [20,783 x 42] (S3: tbl_df/tbl/data.frame) ## $ tag : chr [1:20783] &quot;00088cbed7&quot; &quot;00088cbed8&quot; &quot;00088cbedb&quot; &quot;00088cbedd&quot; ... ## $ species : chr [1:20783] &quot;bkt&quot; &quot;bnt&quot; &quot;bkt&quot; &quot;bkt&quot; ... ## $ river : chr [1:20783] &quot;wb obear&quot; &quot;west brook&quot; &quot;west brook&quot; &quot;wb obear&quot; ... ## $ detectionDate : POSIXct[1:20783], format: &quot;2014-09-17 00:00:00&quot; &quot;2012-09-26 11:01:00&quot; &quot;2014-09-24 11:45:00&quot; &quot;2012-09-21 00:00:00&quot; ... ## $ sampleNumber : num [1:20783] 79 71 79 71 79 71 71 79 71 79 ... ## $ n : num [1:20783] 2 3 1 3 1 1 4 2 1 1 ... ## $ proportionSampled : num [1:20783] 1 1 1 1 1 1 1 1 1 1 ... ## $ observedLength : num [1:20783] 70 86 89 61 60 64 70 62 87 73 ... ## $ observedWeight : num [1:20783] 3.5 6.7 8.3 2.4 2.4 2.8 4.6 2.3 7.5 4.2 ... ## $ area : chr [1:20783] &quot;trib&quot; &quot;inside&quot; &quot;inside&quot; &quot;trib&quot; ... ## $ date : Date[1:20783], format: &quot;2014-09-17&quot; &quot;2012-09-26&quot; &quot;2014-09-24&quot; &quot;2012-09-21&quot; ... ## $ yday : num [1:20783] 260 270 267 265 269 270 264 260 270 258 ... ## $ year : num [1:20783] 2014 2012 2014 2012 2014 ... ## $ spawnDate : Date[1:20783], format: &quot;2013-11-15&quot; &quot;2011-11-15&quot; &quot;2013-11-15&quot; &quot;2011-11-15&quot; ... ## $ emergeDate : Date[1:20783], format: &quot;2014-03-01&quot; &quot;2012-03-01&quot; &quot;2014-03-01&quot; &quot;2012-03-01&quot; ... ## $ spawn_emerge_sumT : num [1:20783] 110 358 131 313 131 ... ## $ spawn_emerge_meanT : num [1:20783] 1.03 3.32 1.22 2.9 1.22 ... ## $ spawn_emerge_sdT : num [1:20783] 1.36 2.3 1.56 2.43 1.56 ... ## $ spawn_emerge_cvT : num [1:20783] 1.321 0.695 1.274 0.838 1.274 ... ## $ spawn_emerge_sumF : num [1:20783] 0 48.7 25.7 0 25.7 ... ## $ spawn_emerge_meanF : num [1:20783] NaN 0.451 0.24 NaN 0.24 ... ## $ spawn_emerge_sdF : num [1:20783] NA 0.457 0.352 NA 0.352 ... ## $ spawn_emerge_cvF : num [1:20783] NA 1.01 1.47 NA 1.47 ... ## $ spawn_emerge_n : int [1:20783] 107 108 107 108 107 108 108 107 108 107 ... ## $ emerge_detect_sumT : num [1:20783] 2191 2791 2597 2602 2622 ... ## $ emerge_detect_meanT: num [1:20783] 10.9 13.3 12.5 12.7 12.5 ... ## $ emerge_detect_sdT : num [1:20783] 5.74 4.82 6.36 5 6.33 ... ## $ emerge_detect_cvT : num [1:20783] 0.527 0.362 0.51 0.394 0.507 ... ## $ emerge_detect_sumF : num [1:20783] 0 28.6 71.6 0 71.6 ... ## $ emerge_detect_meanF: num [1:20783] NaN 0.136 0.344 NaN 0.341 ... ## $ emerge_detect_sdF : num [1:20783] NA 0.246 0.533 NA 0.532 ... ## $ emerge_detect_cvF : num [1:20783] NA 1.81 1.55 NA 1.56 ... ## $ emerge_detect_n : int [1:20783] 201 210 208 205 210 210 204 201 210 199 ... ## $ spawn_detect_sumT : num [1:20783] 2301 3149 2728 2915 2753 ... ## $ spawn_detect_meanT : num [1:20783] 7.5 9.93 8.69 9.34 8.71 ... ## $ spawn_detect_sdT : num [1:20783] 6.65 6.27 7.48 6.32 7.46 ... ## $ spawn_detect_cvT : num [1:20783] 0.887 0.631 0.861 0.677 0.857 ... ## $ spawn_detect_sumF : num [1:20783] 0 77.1 97.2 0 97.2 ... ## $ spawn_detect_meanF : num [1:20783] NaN 0.243 0.31 NaN 0.307 ... ## $ spawn_detect_sdF : num [1:20783] NA 0.365 0.482 NA 0.481 ... ## $ spawn_detect_cvF : num [1:20783] NA 1.5 1.56 NA 1.57 ... ## $ spawn_detect_n : int [1:20783] 307 317 314 312 316 317 311 307 317 305 ... 4.1.4 Counts of captured fish Need to decide whether to include in a model. Spotty data. countsRSY &lt;- firstObs %&gt;% group_by(river, species, year) %&gt;% summarize( count = n(), meanPropSampled = mean(proportionSampled, na.rm = TRUE) ) %&gt;% mutate(countAdj = count / meanPropSampled) countsRY &lt;- firstObs %&gt;% group_by(river, year) %&gt;% summarize( count = n(), meanPropSampled = mean(proportionSampled, na.rm = TRUE) ) %&gt;% mutate(countAdj = count / meanPropSampled) ggplot(countsRY, aes(year, countAdj, color = river)) + geom_point() + geom_line() ggplot(countsRSY, aes(year, countAdj, color = species)) + geom_point() + geom_line() + facet_wrap(~ river) 4.2 Raw data plots 4.2.1 Frequency plots by species and river 4.2.1.1 Brook Trout, West brook #cd1 &lt;- cdWB_electro %&gt;% filter(ageInSamples == 1, species != &#39;ats&#39;) plotSppRiv = function(s, r) { ggplot(firstObs %&gt;% filter(species == s, river == r), aes(observedLength, color = is.na(tag))) + geom_freqpoly() + geom_vline(xintercept = 60) + ggtitle(paste(s, r, sep = &#39;, &#39;)) + xlim(c(30,125)) + facet_wrap(~ year, scales = &quot;free_y&quot;) } species = &#39;bkt&#39; riverOrdered = &quot;west brook&quot; plotSppRiv(species, riverOrdered) 4.2.1.2 Brook Trout, wb jimmy 4.2.1.3 Brook Trout, wb mitchell 4.2.1.4 Brook Trout, wb obear 4.2.1.5 Brown Trout, West brook 4.2.1.6 Brown Trout, wb jimmy 4.2.1.7 Brown Trout, wb mitchell 4.2.1.8 Brown Trout, wb obear - there are no Brown trout in OBear 4.2.2 Trout, in the WB mainstem only ggplot(firstObs %&gt;% filter(species != &quot;ats&quot;), aes(observedLength)) + geom_freqpoly() + geom_vline(xintercept = 60, color = &#39;orange&#39;) + facet_grid(species ~ year) ggplot(firstObs %&gt;% filter(species != &quot;ats&quot;), aes(observedLength, color = is.na(tag))) + geom_freqpoly() + geom_vline(xintercept = 60, color = &#39;orange&#39;) + facet_grid(species ~ year) 4.2.3 Why are there untagged fish bigger than 60mm? Check 2002/bkt/WB, as an example firstObs2002BKT &lt;- firstObs %&gt;% filter(year == 2002, species == &quot;bkt&quot;) table(is.na(cdWB12002BKT$tag)) ## ## FALSE TRUE ## 295 253 ggplot(firstObs2002BKT, aes(observedLength, color = is.na(tag))) + geom_freqpoly() + geom_vline(xintercept = 60) # looks like untagged area=inside fish wee morts, the rest were above or below ggplot(firstObs2002BKT, aes(observedLength, color = is.na(tag))) + geom_freqpoly() + geom_vline(xintercept = 60) + facet_grid(~area) # check 2003 ggplot(firstObs %&gt;% filter(year == 2003, species == &quot;bkt&quot;), aes(observedLength, color = is.na(tag))) + geom_freqpoly() + geom_vline(xintercept = 60) + facet_grid(~area) # same story as 2002 4.2.4 Why no untagged fish at all for 2000 and 2001? cfirstObs2000_2001BKT &lt;- firstObs %&gt;% filter(year %in% 2000:2001, species == &quot;bkt&quot;) table(is.na(cfirstObs2000_2001BKT$tag)) ## ## FALSE ## 343 table(cfirstObs2000_2001BKT$observedLength) ## ## 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 85 90 ## 18 23 23 26 20 28 19 14 28 23 20 21 9 14 8 11 3 8 4 5 6 5 1 3 2 1 cfirstObs2000_2001BKT %&gt;% filter(observedLength &lt; 60) ## # A tibble: 64 x 18 ## tag species river detectionDate sampleNumber n proportionSampl~ observedLength observedWeight area date yday ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dttm&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;date&gt; &lt;dbl&gt; ## 1 1bf0f~ bkt west~ 2001-09-10 12:00:00 27 2 1 58 1.9 insi~ 2001-09-10 253 ## 2 1bf0f~ bkt west~ 2001-09-07 12:00:00 27 2 1 57 1.9 insi~ 2001-09-07 250 ## 3 1bf0f~ bkt west~ 2001-09-07 12:00:00 27 1 1 59 2.1 insi~ 2001-09-07 250 ## 4 1bf0f~ bkt west~ 2001-09-07 12:00:00 27 6 1 59 2.1 insi~ 2001-09-07 250 ## 5 1bf0f~ bkt west~ 2001-09-06 12:00:00 27 1 1 59 2.2 insi~ 2001-09-06 249 ## 6 1bf0f~ bkt west~ 2001-09-10 12:00:00 27 1 1 57 1.9 insi~ 2001-09-10 253 ## 7 1bf0f~ bkt west~ 2001-09-07 12:00:00 27 3 1 58 2 insi~ 2001-09-07 250 ## 8 1bf0f~ bkt west~ 2001-09-10 12:00:00 27 2 1 58 2.1 insi~ 2001-09-10 253 ## 9 1bf0f~ bkt west~ 2001-09-06 12:00:00 27 4 1 58 2 insi~ 2001-09-06 249 ## 10 1bf0f~ bkt west~ 2001-09-07 12:00:00 27 3 1 58 1.8 insi~ 2001-09-07 250 ## # ... with 54 more rows, and 6 more variables: year &lt;dbl&gt;, spawnDate &lt;date&gt;, emergeDate &lt;date&gt;, spawn_emerge &lt;list&gt;, ## # emerge_detect &lt;list&gt;, spawn_detect &lt;list&gt; ggplot(cfirstObs2000_2001BKT, aes(observedLength, color = is.na(tag))) + geom_freqpoly() + geom_vline(xintercept = 60) 4.3 Yearly means means &lt;- firstObs %&gt;% group_by(species, year) %&gt;% summarize(meanLength = mean(observedLength, na.rm = TRUE), meanYday = mean(yday, na.rm = TRUE) ) ggplot(means, aes(year, meanLength, color = species)) + geom_point() + geom_line() ggplot(means, aes(meanYday, meanLength, color = species)) + geom_point() + geom_smooth(method = &quot;lm&quot;) "],["intro.html", "Chapter 5 Introduction", " Chapter 5 Introduction You can label chapter and section titles using {#label} after them, e.g., we can reference Chapter 5. If you do not manually label them, there will be automatic labels anyway, e.g., Chapter 7. test Figures and tables with captions will be placed in figure and table environments, respectively. par(mar = c(4, 4, .1, .1)) #plot(pressure, type = &#39;b&#39;, pch = 19) Reference a figure by its code chunk label with the fig: prefix, e.g., see Figure ??. Similarly, you can reference tables generated from knitr::kable(), e.g., see Table 5.1. knitr::kable( head(iris, 20), caption = &#39;Here is a nice table!&#39;, booktabs = TRUE ) Table 5.1: Here is a nice table! Sepal.Length Sepal.Width Petal.Length Petal.Width Species 5.1 3.5 1.4 0.2 setosa 4.9 3.0 1.4 0.2 setosa 4.7 3.2 1.3 0.2 setosa 4.6 3.1 1.5 0.2 setosa 5.0 3.6 1.4 0.2 setosa 5.4 3.9 1.7 0.4 setosa 4.6 3.4 1.4 0.3 setosa 5.0 3.4 1.5 0.2 setosa 4.4 2.9 1.4 0.2 setosa 4.9 3.1 1.5 0.1 setosa 5.4 3.7 1.5 0.2 setosa 4.8 3.4 1.6 0.2 setosa 4.8 3.0 1.4 0.1 setosa 4.3 3.0 1.1 0.1 setosa 5.8 4.0 1.2 0.2 setosa 5.7 4.4 1.5 0.4 setosa 5.4 3.9 1.3 0.4 setosa 5.1 3.5 1.4 0.3 setosa 5.7 3.8 1.7 0.3 setosa 5.1 3.8 1.5 0.3 setosa You can write citations, too. For example, we are using the bookdown package (Xie 2021) in this sample book, which was built on top of R Markdown and knitr (Xie 2015). References "],["literature.html", "Chapter 6 Literature", " Chapter 6 Literature Here is a review of existing methods. "],["methods.html", "Chapter 7 Methods", " Chapter 7 Methods We describe our methods in this chapter. "],["applications.html", "Chapter 8 Applications 8.1 Example one 8.2 Example two", " Chapter 8 Applications Some significant applications are demonstrated in this chapter. 8.1 Example one 8.2 Example two "],["final-words.html", "Chapter 9 Final Words", " Chapter 9 Final Words We have finished a nice book. "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
